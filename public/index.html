<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Weather Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body
    class="bg-gradient-to-br from-gray-900 via-gray-800 to-black min-h-screen text-gray-100 p-4 md:p-8"
  >
    <div class="max-w-7xl mx-auto">
      <!-- Header -->
      <header class="text-center mb-8 md:mb-12">
        <h1
          class="text-4xl md:text-5xl font-extralight tracking-widest text-white mb-3"
        >
          WEATHER
        </h1>
        <p class="text-lg md:text-xl text-gray-400 font-light" id="location">
          Loading location...
        </p>
        <p class="text-xs md:text-sm text-gray-600 mt-2" id="lastUpdated">
          Last updated: --
        </p>
      </header>

      <!-- Current Weather -->
      <div
        class="bg-white/5 border border-white/10 rounded-3xl p-6 md:p-10 mb-8 backdrop-blur-sm shadow-2xl"
      >
        <div
          class="flex flex-col md:flex-row items-center justify-between gap-6 mb-8"
        >
          <!-- Temperature Section -->
          <div class="flex items-center gap-6">
            <div class="relative group">
              <img
                id="currentIcon"
                src=""
                alt="Weather icon"
                class="w-24 h-24 md:w-32 md:h-32 drop-shadow-2xl cursor-help"
              />
              <div
                class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-sm rounded-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap z-10"
              >
                <span id="currentIconTooltip">Weather condition</span>
                <div
                  class="absolute top-full left-1/2 transform -translate-x-1/2 -mt-1 border-4 border-transparent border-t-gray-900"
                ></div>
              </div>
            </div>
            <div>
              <div
                class="text-6xl md:text-8xl font-extralight text-white leading-none"
                id="currentTemp"
              >
                --°
              </div>
              <div class="text-base md:text-lg text-gray-400 mt-2">
                Feels like <span id="feelsLike">--°</span>
              </div>
            </div>
          </div>

          <!-- Weather Description -->
          <div class="text-center md:text-right">
            <div
              class="text-2xl md:text-3xl font-light capitalize text-gray-200"
              id="weatherDesc"
            >
              --
            </div>
            <div class="text-sm text-gray-500 mt-1" id="weatherMain">--</div>
          </div>
        </div>

        <!-- Weather Details Grid -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6">
          <div class="bg-white/5 rounded-xl p-4 border border-white/5">
            <div class="text-xs md:text-sm text-gray-500 mb-1">Humidity</div>
            <div
              class="text-xl md:text-2xl font-light text-white"
              id="humidity"
            >
              --%
            </div>
          </div>
          <div class="bg-white/5 rounded-xl p-4 border border-white/5">
            <div class="text-xs md:text-sm text-gray-500 mb-1">Wind Speed</div>
            <div
              class="text-xl md:text-2xl font-light text-white"
              id="windSpeed"
            >
              -- mph
            </div>
          </div>
          <div class="bg-white/5 rounded-xl p-4 border border-white/5">
            <div class="text-xs md:text-sm text-gray-500 mb-1">Pressure</div>
            <div
              class="text-xl md:text-2xl font-light text-white"
              id="pressure"
            >
              -- hPa
            </div>
          </div>
          <div class="bg-white/5 rounded-xl p-4 border border-white/5">
            <div class="text-xs md:text-sm text-gray-500 mb-1">Visibility</div>
            <div
              class="text-xl md:text-2xl font-light text-white"
              id="visibility"
            >
              -- mi
            </div>
          </div>
        </div>
      </div>

      <!-- 12 Hour Forecast -->
      <div
        class="bg-white/5 border border-white/10 rounded-3xl p-6 md:p-10 backdrop-blur-sm shadow-2xl"
      >
        <h2
          class="text-2xl md:text-3xl font-extralight tracking-wide text-white mb-6"
        >
          Next 12 Hours
        </h2>
        <div
          class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4"
          id="hourlyForecast"
        >
          <!-- Hourly cards will be inserted here -->
        </div>
      </div>

      <!-- Loading Spinner -->
      <div
        id="loadingSpinner"
        class="fixed inset-0 bg-black/80 flex items-center justify-center z-50"
      >
        <div class="text-center">
          <div
            class="inline-block animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-blue-400 mb-4"
          ></div>
          <p class="text-gray-300 text-lg">Loading weather data...</p>
        </div>
      </div>

      <!-- Error Message -->
      <div
        id="errorMessage"
        class="hidden fixed top-4 right-4 bg-red-900/90 border border-red-600 text-white px-6 py-4 rounded-lg shadow-2xl z-50"
      >
        <p class="font-semibold">Error loading weather data</p>
        <p class="text-sm text-gray-300 mt-1" id="errorText">
          Please check your API endpoint
        </p>
      </div>
    </div>

    <script>
      // API Configuration
      const API_URL = "http://andre:4000/api/full";
      const API_KEY =
        "sk_32302a2b833e44b4b108ac67696736939ca383004cb3d0e5da34f37c293c5192"; // Replace with your actual API key

      // Update interval (5 minutes in milliseconds)
      const UPDATE_INTERVAL = 5 * 60 * 1000;

      // Fetch and display weather data
      async function fetchWeatherData() {
        try {
          const response = await fetch(API_URL, {
            headers: {
              "X-API-Key": API_KEY,
            },
          });
          if (!response.ok)
            throw new Error(
              `Failed to fetch weather data: ${response.status} ${response.statusText}`
            );

          const result = await response.json();
          const data = result.data;

          updateCurrentWeather(data);
          updateHourlyForecast(data);
          updateLastUpdated(result.timestamp);
          updatePageTitle(data);

          hideLoading();
        } catch (error) {
          console.error("Error fetching weather:", error);
          showError(error.message);
          hideLoading();
        }
      }

      function updateCurrentWeather(data) {
        const current = data.current;
        const location =
          data.location || `${data.lat.toFixed(2)}°, ${data.lon.toFixed(2)}°`;

        document.getElementById("location").textContent = location;
        document.getElementById("currentTemp").textContent =
          Math.round(current.temp) + "°";
        document.getElementById("feelsLike").textContent =
          Math.round(current.feels_like) + "°";
        document.getElementById("weatherDesc").textContent =
          current.weather[0].description;
        document.getElementById("weatherMain").textContent =
          current.weather[0].main;

        const iconImg = document.getElementById("currentIcon");
        iconImg.src = `https://openweathermap.org/img/wn/${current.weather[0].icon}@4x.png`;
        iconImg.alt = current.weather[0].description;
        document.getElementById("currentIconTooltip").textContent =
          current.weather[0].description.charAt(0).toUpperCase() +
          current.weather[0].description.slice(1);

        document.getElementById("humidity").textContent =
          current.humidity + "%";
        document.getElementById("windSpeed").textContent =
          current.wind_speed.toFixed(1) + " mph";
        document.getElementById("pressure").textContent =
          current.pressure + " hPa";
        document.getElementById("visibility").textContent =
          (current.visibility / 1609.34).toFixed(1) + " mi";
      }

      function updateHourlyForecast(data) {
        const hourlyContainer = document.getElementById("hourlyForecast");
        hourlyContainer.innerHTML = "";

        // Get next 12 hours
        const next12Hours = data.hourly.slice(1, 13);

        next12Hours.forEach((hour) => {
          const time = new Date(hour.dt * 1000);
          const timeString = time.toLocaleTimeString("en-US", {
            hour: "numeric",
            hour12: true,
          });

          const card = document.createElement("div");
          card.className =
            "bg-white/5 rounded-xl p-4 border border-white/5 text-center hover:bg-white/10 transition-colors";
          card.innerHTML = `
                    <div class="text-sm text-gray-400 mb-2">${timeString}</div>
                    <div class="relative group inline-block">
                      <img src="https://openweathermap.org/img/wn/${
                        hour.weather[0].icon
                      }@2x.png" 
                           alt="${hour.weather[0].description}" 
                           class="w-12 h-12 mx-auto mb-2 cursor-help">
                      <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-gray-900 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap z-10">
                        ${
                          hour.weather[0].description.charAt(0).toUpperCase() +
                          hour.weather[0].description.slice(1)
                        }
                        <div class="absolute top-full left-1/2 transform -translate-x-1/2 -mt-1 border-4 border-transparent border-t-gray-900"></div>
                      </div>
                    </div>
                    <div class="text-2xl font-light text-white mb-1">${Math.round(
                      hour.temp
                    )}°</div>
                    <div class="text-xs text-gray-500 capitalize">${
                      hour.weather[0].main
                    }</div>
                    <div class="text-xs text-gray-600 mt-2">
                        <div>💧 ${hour.humidity}%</div>
                        <div class="mt-1">💨 ${hour.wind_speed.toFixed(
                          0
                        )} mph</div>
                    </div>
                `;
          hourlyContainer.appendChild(card);
        });
      }

      function updatePageTitle(data) {
        const location =
          data.location || `${data.lat.toFixed(2)}°, ${data.lon.toFixed(2)}°`;
        const temp = Math.round(data.current.temp);
        const condition = data.current.weather[0].main;
        document.title = `${temp}° ${condition} - ${location}`;
      }

      function updateLastUpdated(timestamp) {
        document.getElementById(
          "lastUpdated"
        ).textContent = `Last updated: ${timestamp.display}`;
      }

      function hideLoading() {
        document.getElementById("loadingSpinner").classList.add("hidden");
      }

      function showError(message) {
        const errorDiv = document.getElementById("errorMessage");
        document.getElementById("errorText").textContent = message;
        errorDiv.classList.remove("hidden");
        setTimeout(() => {
          errorDiv.classList.add("hidden");
        }, 5000);
      }

      // Initial load
      fetchWeatherData();

      // Set up auto-refresh every 5 minutes
      setInterval(fetchWeatherData, UPDATE_INTERVAL);
    </script>
  </body>
</html>
